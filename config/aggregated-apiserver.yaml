---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: argoproj-metrics-poc-apiserver
  namespace: default
  labels:
    api: argoproj-metrics-poc
    apiserver: "true"
spec:
  selector:
    matchLabels:
      api: argoproj-metrics-poc
      apiserver: "true"
  replicas: 1
  template:
    metadata:
      labels:
        api: argoproj-metrics-poc
        apiserver: "true"
    spec:
      containers:
      - name: apiserver
        image: zachaller/argoproj-metrics-poc
        volumeMounts:
        - name: apiserver-certs
          mountPath: /apiserver.local.config/certificates
          readOnly: true
        command:
        - "/apiserver"
        workingDir: /
        args:
        - "--etcd-servers=http://etcd-svc:2379"
        - "--tls-cert-file=/apiserver.local.config/certificates/tls.crt"
        - "--tls-private-key-file=/apiserver.local.config/certificates/tls.key"
        - "--audit-log-path=-"
        - "--feature-gates=APIPriorityAndFairness=false"
        - "--audit-log-maxage=0"
        - "--audit-log-maxbackup=0"
        resources:
          requests:
            cpu: 100m
            memory: 20Mi
          limits:
            cpu: 100m
            memory: 300Mi
      volumes:
      - name: apiserver-certs
        secret:
          secretName: argoproj-metrics-poc
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: argoproj-metrics-poc
  namespace: default
  labels:
    api: argoproj-metrics-poc
    apiserver: "true"
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURzekNDQXB1Z0F3SUJBZ0lJUmI1WFVPaGo4S0l3RFFZSktvWklodmNOQVFFTEJRQXdkREVMTUFrR0ExVUUKQmhNQ2RXNHhDekFKQmdOVkJBZ01Bbk4wTVFvd0NBWURWUVFIREFGc01Rb3dDQVlEVlFRS0RBRnZNUXN3Q1FZRApWUVFMREFKdmRURXpNREVHQTFVRUF3d3FZWEpuYjNCeWIyb3RiV1YwY21samN5MXdiMk10WTJWeWRHbG1hV05oCmRHVXRZWFYwYUc5eWFYUjVNQjRYRFRJeU1URXhOVEl4TXpRME9Wb1hEVE15TVRFeE1qSXhNelEwT1Zvd0t6RXAKTUNjR0ExVUVBeE1nWVhKbmIzQnliMm90YldWMGNtbGpjeTF3YjJNdVpHVm1ZWFZzZEM1emRtTXdnZ0VpTUEwRwpDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRRFFPMnJCQzNCMi8vdTNPYnlSZEU1MVNsczVjcTdEClZRQUtaUFREM0M0YVh1N09EbUh2dHhpRXdMa1pxa09iMFZTMWRYNnlDbVpCM00wVmNQVU1RV250Q2xDZ3VFT04KZERXNktMSWx5Slh5R2dqZ1ZuU2RzVTJkYllRYm9tTTF6TTNEOEtWNXZ6emFqNTRkSFIzcSt2bHkrcVFjQnpUdgppOVJyQ3BJb1V1N0dnWmdSem96VjRJQVlLVXBvbWFtSUFUQXRSRVVxUTZQNjkzK2RNSXRVUGZoaEFUUUQxYytUCmxsWU9NdDhUcVNYWnVhUjBJUTFML2srbVUybjVjd3kzaFVxWFNzWlJOZ05GTXo5MHZEZ2FFN2tGWkFkd0pnemsKNjFvcHlkdkJFUzJIZHQya2xYQ0REY1dzZnN2Q2lCYzZwVWVsRXY5bzNRMlQzNTVPQVFVS0w2TmZBZ01CQUFHagpnWkV3Z1k0d0RnWURWUjBQQVFIL0JBUURBZ1dnTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGCkJRY0RBakFmQmdOVkhTTUVHREFXZ0JUb1phTXd4bWNXVUZVdzZ0THMrOGw0QnpOMmREQThCZ05WSFJFRU5UQXoKZ2dsc2IyTmhiR2h2YzNTQ0lHRnlaMjl3Y205cUxXMWxkSEpwWTNNdGNHOWpMbVJsWm1GMWJIUXVjM1pqaHdSLwpBQUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCRVEvUTd0UjdHNEFpL2d2UnU3a2g2OFRsSVlNczd1RGowCjF4YjVlYlN4dU9oY1RtSExsWkw2OGtWdldIeDM0K0x2emtZMVB4OHZzYSsyQm8yNEp0SXdCSFNvc2RMMWNkMDEKRlpoaDFXaHFKNzNhUWM5WnhzQ3Vqc0hCZGtRSW9HZ2dCelFDbnVjSWNjeGZwTkxGRjNaUVVXeE1mYXNCZ0pYZwpWQXA4aDkrM0Q4elZvQlBzSWZlM28vcVRzZTZMWkpwYzdLYlgzbmhhQXEvc3RCZjdKWHZpdklDYmwzRXk5YWVICm0zeE8xMTJORStndnJzRGNlTWttRCtBSTdUWENnYnp3bU9BMjdaRnpBVkdQQXFwcWE5Ykk5anZsT3VCV2ZnN3UKbXFXSjlKUVJjMW5RZ1J3TE5MRFFZQmJ3RnBZUUtJc2cwcHJMTlBIdGxmKzJkUHJ2REhJSAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMER0cXdRdHdkdi83dHptOGtYUk9kVXBiT1hLdXcxVUFDbVQwdzl3dUdsN3V6ZzVoCjc3Y1loTUM1R2FwRG05RlV0WFYrc2dwbVFkek5GWEQxREVGcDdRcFFvTGhEalhRMXVpaXlKY2lWOGhvSTRGWjAKbmJGTm5XMkVHNkpqTmN6TncvQ2xlYjg4Mm8rZUhSMGQ2dnI1Y3Zxa0hBYzA3NHZVYXdxU0tGTHV4b0dZRWM2TQoxZUNBR0NsS2FKbXBpQUV3TFVSRktrT2ordmQvblRDTFZEMzRZUUUwQTlYUGs1WldEakxmRTZrbDJibWtkQ0VOClMvNVBwbE5wK1hNTXQ0VktsMHJHVVRZRFJUTS9kTHc0R2hPNUJXUUhjQ1lNNU90YUtjbmJ3UkV0aDNiZHBKVncKZ3czRnJIN0x3b2dYT3FWSHBSTC9hTjBOazkrZVRnRUZDaStqWHdJREFRQUJBb0lCQUVpbGNna0hSS1UvaVVIVApFc1pzSFRNdVRjVXREV3Q0TEJ0MFBUQlhrSDRDd0syQ3R3ZzZpSU5IK1V2SzZ1dGhqSHdDRWNGcmYyRmE5dkdVCkJ1blBxSFRhTkdiZDRqTm5aNWNhdTR3Uy9yMEgrRERMK01OTEtCalVMRkszeElUd2ZwanRTODI5dWkxR0RaTjYKcFFWbHFjRkRVQjIzSmZDc2g5OFFRUTF3WVgwKzk4Qkx6NHV1eVp3Z3oxWmcraERXQ09MeklKRE9nU2VpUVB4bQplTjQxbWZNV2drZldhQ3RYNllYNDF4YStqRFdUSDI2cWUvbitHT0pRZk1CSm5sUlliZ2JpQlVPT1hmVmNWaTdhCjlPZExFL2JEZlFOUXVkOHJtREROekhmZW1JdmkyTzBXbkFaM2FHQW44djVmMDNnZFJmMldwdVZaVkdkck90NkIKS1Z1T2pZRUNnWUVBMmUxOW12Qi93TGtNcGdlQ0d4Z1hVTGtvZDFLR3prVjRmSGFwUkhJcnRvQkxnbFE1MTluQQptV3BvR1NNRU5pNTFKOHEyYkY0NWRuUm85RmlycDFQTys0UXliRnNTMjR2QzdsTXU4U0tRRlJwbTd3RDhBemlaCmlueDRsMERlYUxYMlBiREhSREtMcmNuVWxIa1EzMnFQaVlsYUFtaU13LzRyaElrNld1M0FEM3NDZ1lFQTlKeE4KNXJSOVdnZ2IrZTVCZUwxN2xzeDQ2N2RTbEVCNXVIWXFQYkc0RGkrMVJwTTA5V0NlZ1YyNExNWk5ldEhLbkllZwpRTnMwUHNRc1pWRXFxSmVXd0trNEduc3p6SDlIczF0blFaRTR6MjRLVDFzZ0NYN0JWa0dWWDZyajhKZUN1SDhCCjJDWURGM0ZDL2hHS1hiUHpYaVMzcng0TW85MjVjdzI3cGdjSFpHMENnWUJtejNuQVROR1lWRFM1WnpWa0h0dHgKQThrcGNjK1RKSWNSQU5JZUxsYWRCSzJhMEsxeFBaTjFUUlBMT0EvV2w5aEJhNHJnV1J0MjNMaGUvaTROQktiVApWYXlNSGZNcGpDZnNVMllEOExCVXBGNEhSMG1kSTJpY1F0aUpVdHNhUHkzcU1LbnhiSDhrLytEQUl0Vm84VmJDCkpnQkd2cGdhSnFEVktBQlZ3WEFvWFFLQmdRQ1ZCUnhZYnFEblZvVmtzQWZtL05qc044bDdJUVlJRjNlUUx6encKdFBLQ2dnSVg2dHFhbXJBMTg5aWVQbms1VjlIdHBwcTBxRmFkM25tRmgvdExGbjdiQkx5UE5YdUxIQWVjZHhUaQoxd3diSXRqWkc1VGE5QVBvL3E5M3h1NXl4bnIyMXpsU2EyWDZ4QitpRlNHTWtISzFhZjBWakdMNitidGZJb0N0ClZ4N2p5UUtCZ1FDVncvdUtqWnVoY3JlcUExcEhoL2xmZitTVzBOM2FFSTlLU1FkclZvUEQ4ZHo1cUw3blBCN1YKdkJOZGdoOU15cUhjcnhjYkUweVBYTnlkYlBWUEhua3M1OERtM2I1VGx3dmlQSERHRFdud2VndXJsbUgrWkJ5eApSbFRCY0pEM3hZZlRmTWk5TWlhd3I3ZEM1bFFRVHRmaTVGbEpmNlFIOHlqbHRlTk9EQW9FMXc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
apiVersion: v1
kind: Service
metadata:
  name: argoproj-metrics-poc
  namespace: default
  labels:
    api: argoproj-metrics-poc
    apiserver: "true"
spec:
  ports:
  - port: 443
    protocol: TCP
    targetPort: 443
  selector:
    api: argoproj-metrics-poc
    apiserver: "true"
